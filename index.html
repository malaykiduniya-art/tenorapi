<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GIF Redirect</title>
    <script>
        async function getAndRedirect() {
            const params = new URLSearchParams(window.location.search);
            const target = params.get('getgif');
            if (!target) return;

            try {
                // 1. Fetch from your Deno proxy
                const response = await fetch(`https://viprix.deno.dev/?target=${encodeURIComponent(target)}`);
                const html = await response.text();

                // 2. Find the og:image content
                const match = html.match(/<meta[^>]+property="og:image"[^>]+content="([^"]+\.gif)"/i);
                
                if (match && match[1]) {
                    const longUrl = match[1];
                    
                    // 3. Extract ID and build the short URL
                    const idMatch = longUrl.match(/\/m\/([^\/]+)/);
                    if (idMatch && idMatch[1]) {
                        const shortUrl = `https://c.tenor.com/${idMatch[1]}/tenor.gif`;
                        
                        // 4. Redirect to the direct short GIF
                        window.location.replace(shortUrl);
                    } else {
                        window.location.replace(longUrl); // Fallback to long URL
                    }
                }
            } catch (err) {
                document.body.innerText = "Error processing GIF.";
            }
        }
        getAndRedirect();
    </script>
</head>
<body>
    Processing direct link...
</body>
</html>
